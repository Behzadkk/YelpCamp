<% include ../partials/header %>

<div class="row">
  <div class="col-lg-3">
    <p class="lead">Yelp Camp</p>
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" href="#"><%=campground.name %></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#desc">Describtion</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#map">Location</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#reviews">Reviews</a>
      </li>
    </ul>
    <div class="mb-4" id="map"></div>
  </div>
  <div class="col-lg-9">
    <div class="card">
      <img
        class="card-img-top"
        alt="<%= campground.name %>"
        src="<%=campground.image %>"
      />
      <div id="desc">
        <h6 class="card-header text-right py-1">
          Â£<%=campground.price%>/night
        </h6>
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <h4 class="card-title"><a><%= campground.name %></a></h4>
            <div>
              <%if(currentUser && campground.author.id.equals(currentUser._id)
              || currentUser && currentUser.isAdmin){%>
              <a
                class="btn btn-sm btn-warning"
                href="/campgrounds/<%=campground._id %>/edit"
                >Edit</a
              >
              <form
                class="delete-form"
                action="/campgrounds/<%=campground._id %>?_method=DELETE"
                method="POST"
              >
                <button class="btn btn-sm btn-danger">Delete</button>
              </form>
              <%}%>
            </div>
          </div>
          <p class="card-text"><%= campground.description %></p>
          <p class="blockquote-footer">
            <em
              >Submitted by:
              <a href="/users/<%= campground.author.id %>"
                ><%= campground.author.username %></a
              >, <%= moment(campground.createdAt).fromNow() %></em
            >
          </p>
        </div>
      </div>
    </div>
    <div id="reviews" class="card border-top-0">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <h5>Reviews</h5>
        <a
          class="btn btn-success"
          href="/campgrounds/<%=campground._id %>/comments/new"
          >Add New Comment</a
        >
      </div>
      <div class="card-body">
        <% campground.comments.forEach(function(comment){ %>
        <div class="mb-3">
          <div class="d-flex justify-content-between">
            <strong><%= comment.author.username %></strong>
            <span class="font-weight-light small"
              ><%= moment(comment.createdAt).fromNow() %></span
            >
          </div>
          <div class="col-md-12 pr-0">
            <p><em>"<%= comment.text %>"</em></p>
            <%if(currentUser && comment.author.id.equals(currentUser._id) ||
            currentUser && currentUser.isAdmin){%>
            <div class="text-right">
              <a
                class="btn btn-sm btn-warning"
                href="/campgrounds/<%=campground._id %>/comments/<%=comment._id%>/edit"
                >Edit</a
              >
              <form
                class="delete-form"
                action="/campgrounds/<%=campground._id %>/comments/<%=comment._id%>?_method=DELETE"
                method="POST"
              >
                <input
                  type="submit"
                  class="btn btn-sm btn-danger"
                  value="Delete"
                />
              </form>
            </div>

            <%}%>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </div>
</div>
<script>
  function initMap() {
    var lat = <%= campground.lat %>;
    var lng = <%= campground.lng %>;
    var center = { lat: lat, lng: lng };
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 8,
      center: center,
      scrollwheel: false
    });
    var contentString = `
      <strong><%= campground.name %><br />
      <%= campground.location %></strong>
      <p><%= campground.description %></p>
    `
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });
    var marker = new google.maps.Marker({
      position: center,
      map: map
    });
    marker.addListener('click', function () {
      infowindow.open(map, marker);
    });
  }
</script>
<script
  async
  defer
  src="https://maps.googleapis.com/maps/api/js?key=<%=process.env.LOCAL_SRC_KEY%>&callback=initMap"
></script>

<% include ../partials/footer %>
